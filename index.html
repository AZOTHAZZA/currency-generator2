<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>通貨生成所</title>
<style>
  body { font-family: sans-serif; margin: 0; padding: 0; }
  #dashboard, #searchSection, #statsPanel { padding: 10px; }
  button { padding: 8px 16px; margin: 4px; border-radius: 8px; cursor: pointer; }
  canvas { max-width: 100%; height: auto; }
  /* テーマ色例 */
  :root { --primary-bg: #fff; --button-bg: #007bff; --button-color: #fff; }
  [data-theme="nintendo"] { --primary-bg: #fef6e4; --button-bg: #ff4500; --button-color: #fff; }
  [data-theme="stylish"] { --primary-bg: #1a1a1a; --button-bg: #32cd32; --button-color: #000; }
  body { background-color: var(--primary-bg); }
  button { background-color: var(--button-bg); color: var(--button-color); border: none; box-shadow: 2px 2px 6px rgba(0,0,0,0.2); }
</style>
</head>
<body data-lang="hiragana" data-theme="nintendo">

<h1 id="topTitle">あたらしいおかねのがっこう</h1>

<div id="languageSwitch">
  <button data-lang="hiragana">ひらがな</button>
  <button data-lang="kanji">漢字</button>
  <button data-lang="easy">Easy English</button>
  <button data-lang="expert">Expert English</button>
</div>

<div id="themeSwitch">
  <button data-theme="nintendo">任天堂風</button>
  <button data-theme="stylish">スタイリッシュ風</button>
</div>

<div id="searchSection">
  <input type="text" id="searchQuery" placeholder="キーワードを入力">
  <button id="searchButton">しらべる</button>
</div>

<div id="statsPanel">
  <p>生成合計: <span id="totalMade">0</span> 円</p>
  <p>減額合計: <span id="totalLess">0</span> 円</p>
  <p>削除合計: <span id="totalRemoved">0</span> 円</p>
  <p>AI提案採用率: <span id="aiRate">0</span>%</p>
</div>

<canvas id="statsChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const languageButtons = document.querySelectorAll('#languageSwitch button');
const themeButtons = document.querySelectorAll('#themeSwitch button');

languageButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const lang = btn.getAttribute('data-lang');
    document.documentElement.setAttribute('data-lang', lang);
    updateLanguageUI(lang);
  });
});

themeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const theme = btn.getAttribute('data-theme');
    document.documentElement.setAttribute('data-theme', theme);
  });
});

function updateLanguageUI(lang){
  const topTitle = document.getElementById('topTitle');
  const searchBtn = document.getElementById('searchButton');
  switch(lang){
    case 'hiragana': topTitle.textContent='あたらしいおかねのがっこう'; searchBtn.textContent='しらべる'; break;
    case 'kanji': topTitle.textContent='通貨取扱所'; searchBtn.textContent='検索'; break;
    case 'easy': topTitle.textContent='Money School (Main)'; searchBtn.textContent='Search'; break;
    case 'expert': topTitle.textContent='Currency School (Main)'; searchBtn.textContent='Lookup'; break;
  }
}

// Google検索
document.getElementById('searchButton').addEventListener('click', () => {
  const query = encodeURIComponent(document.getElementById('searchQuery').value.trim());
  if(query) window.open(`https://www.google.com/search?q=${query}`,'_blank');
});

// 履歴データサンプル
let fullHistory = [
  {action:'つくる', amount:1000, ai:true},
  {action:'へらす', amount:200, ai:false},
  {action:'なくす', amount:50, ai:true}
];

function computeStats(){
  const totalMade = fullHistory.filter(h=>h.action==='つくる').reduce((s,h)=>s+h.amount,0);
  const totalLess = fullHistory.filter(h=>h.action==='へらす').reduce((s,h)=>s+h.amount,0);
  const totalRemoved = fullHistory.filter(h=>h.action==='なくす').reduce((s,h)=>s+h.amount,0);
  const aiTotal = fullHistory.filter(h=>h.ai).length;
  const totalActions = fullHistory.length;
  const aiAdoptionRate = totalActions?Math.round((aiTotal/totalActions)*100):0;
  return {totalMade,totalLess,totalRemoved,aiAdoptionRate};
}

function updateStatsUI(){
  const stats = computeStats();
  document.getElementById('totalMade').textContent = stats.totalMade;
  document.getElementById('totalLess').textContent = stats.totalLess;
  document.getElementById('totalRemoved').textContent = stats.totalRemoved;
  document.getElementById('aiRate').textContent = stats.aiAdoptionRate;
  drawStatsChart(stats);
}

function drawStatsChart(stats){
  const ctx=document.getElementById('statsChart').getContext('2d');
  new Chart(ctx,{
    type:'doughnut',
    data:{labels:['つくる','へらす','なくす','AI採用率'],datasets:[{data:[stats.totalMade,stats.totalLess,stats.totalRemoved,stats.aiAdoptionRate],backgroundColor:['#ff4500','#1e90ff','#ffa500','#32cd32']}]},
    options:{responsive:true,plugins:{legend:{position:'bottom'}}}
  });
}

// 初期表示
updateStatsUI();
</script>

</body>
</html>